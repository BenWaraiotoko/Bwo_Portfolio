{{/* 
  Knowledge Graph Shortcode
  Usage: {{< knowledge-graph >}}
  
  Le graphe lit les données depuis /data/graph.json
  ou les projets/posts avec des tags pour créer les connexions
*/}}

<div class="graph-container">
  <h3 class="graph-title">
    <i class="fa-solid fa-diagram-project"></i>
    Interactive Graph
  </h3>
  <div id="knowledge-graph"></div>
</div>

<!-- D3.js -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="/js/knowledge-graph.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Récupérer les données du graphe
  // Option 1: Depuis un fichier JSON
  fetch('/data/graph.json')
    .then(response => {
      if (!response.ok) {
        // Si pas de fichier JSON, générer depuis les métadonnées
        return generateGraphFromContent();
      }
      return response.json();
    })
    .then(data => {
      window.knowledgeGraph = new KnowledgeGraph('knowledge-graph', data, {
        height: 500,
        nodeRadius: 8,
        centerNodeRadius: 14,
        linkDistance: 100,
        chargeStrength: -250
      });
    })
    .catch(error => {
      console.log('Using default graph data');
      // Données par défaut si aucune source disponible
      const defaultData = {
        nodes: [
          { id: 'center', label: 'Portfolio', isCenter: true, url: '/' },
          { id: 'python', label: 'Python', url: '/tags/python/' },
          { id: 'sql', label: 'SQL', url: '/tags/sql/' },
          { id: 'etl', label: 'ETL', url: '/tags/etl/' },
          { id: 'data-engineering', label: 'Data Engineering', url: '/tags/data-engineering/' },
          { id: 'projects', label: 'Projets', url: '/projects/' },
          { id: 'about', label: 'À propos', url: '/about/' }
        ],
        links: [
          { source: 'center', target: 'python' },
          { source: 'center', target: 'sql' },
          { source: 'center', target: 'etl' },
          { source: 'center', target: 'data-engineering' },
          { source: 'center', target: 'projects' },
          { source: 'center', target: 'about' },
          { source: 'python', target: 'etl' },
          { source: 'sql', target: 'etl' },
          { source: 'python', target: 'data-engineering' },
          { source: 'sql', target: 'data-engineering' }
        ]
      };
      
      window.knowledgeGraph = new KnowledgeGraph('knowledge-graph', defaultData, {
        height: 500,
        nodeRadius: 8,
        centerNodeRadius: 14,
        linkDistance: 100,
        chargeStrength: -250
      });
    });
});

// Fonction pour générer le graphe depuis le contenu Hugo
function generateGraphFromContent() {
  // Cette fonction serait appelée si on veut générer dynamiquement
  // Pour Hugo, on préfère généralement générer le JSON au build time
  return Promise.resolve({
    nodes: [
      { id: 'center', label: 'Portfolio', isCenter: true, url: '/' }
    ],
    links: []
  });
}
</script>
